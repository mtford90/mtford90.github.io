<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title></title>
    <!-- Bootstrap -->
    <link href="/blog//css/main.css" rel="stylesheet">
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            var $row = $('.row');
            $row.hover(function () {
                var thisOverlay = $(this).find('.overlay');
                var $overlays = $('.overlay');
                $overlays.finish();
                $overlays.each(function (o) {
                    o = $($overlays[o]);
                    if (o != thisOverlay) {
                        o.css('opacity', 0.3);
                    }
                });
                thisOverlay.css('opacity', 0.0);
            });
            var handleHover = function () {
                var $overlays = $('.overlay');
                $overlays.finish();
                $overlays.css('opacity', 0.0);
            };
            $('#all-posts').hover(undefined, handleHover);
            $('#projects').hover(undefined, handleHover);
        });
    </script>
    <style type="text/css">
        .navbar {
            margin-bottom: 0;
        }
    </style>
</head>
<body>
    <div class="container marketing">
        <div class="navbar navbar-inverse navbar-static-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <a class="navbar-brand" href="/">
                mtford.co.uk
            </a>
        </div>
        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                 
                 
                    <li >
                        <a href="/blog///">
                            Blog
                        </a>
                    </li>
                 
                    <li >
                        <a href="/blog///projects.html">
                            Projects
                        </a>
                    </li>
                 
            </ul>
            <div class="pull-right">
                <a href="/blog//feed.xml"><i class="fa fa-rss"></i></a>
            </div>
        </div>
    </div>
</div>

       <div class="post">
    <div class="row">
        <div class="col-md-12">

            <header class="post-header">
                <h1 class="post-title">Introducing Silk, live profiling for Django</h1>

                <p class="post-meta">Jun 14, 2014</p>
            </header>
            <p>Silk is a live profiling and inspection tool for the Django framework. It:</p>

<ul>
  <li>Intercepts requests and responses, recording:
    <ul>
      <li>SQL Queries</li>
      <li>Response times</li>
      <li>Headers</li>
      <li>Bodies</li>
    </ul>
  </li>
  <li>Allows tracing of SQL queries via Python stack traces</li>
  <li>Profiles blocks of code and functions </li>
  <li>Generates code and commands for replaying requests</li>
</ul>

<p>A <a href="/silk">live demo</a> is actively profiling this site. The
github readme is currently acting as documentation and is available <a href="https://github.com/mtford90/silk">here</a>.</p>

<p>Silk releases can be downloaded from <a href="https://github.com/mtford90/silk/releases">here</a> or installed via pip into your virtualenv:</p>

<p><code>
pip install django-silk
</code></p>

<p>Below is a feature summary:</p>

<h2 id="request-inspection">Request Inspection</h2>

<p>The Silk middleware intercepts and stores requests and responses and stores them in the configured database.
These requests can then be filtered and inspected using Silk’s UI through the request overview:</p>

<p><img src="https://raw.githubusercontent.com/mtford90/silk/master/screenshots/1.png" width="720px" /></p>

<p>Further details on each request are also available by clicking the relevant request:</p>

<p><img src="https://raw.githubusercontent.com/mtford90/silk/master/screenshots/2.png" width="720px" /></p>

<h2 id="sql-inspection">SQL Inspection</h2>

<p>Silk also intercepts SQL queries that are generated by each request. We can get a summary on things like 
the tables involved, number of joins and execution time:</p>

<p><img src="https://raw.githubusercontent.com/mtford90/silk/master/screenshots/3.png" width="720px" /></p>

<p>Before diving into the stack trace to figure out where this request is coming from:</p>

<p><img src="https://raw.githubusercontent.com/mtford90/silk/master/screenshots/5.png" width="720px" /></p>

<h2 id="profiling">Profiling</h2>

<p>Silk can also be used to profile random blocks of code/functions. It provides a decorator and a context
manager for this purpose. </p>

<p>For example:</p>

<p><code>
@silk_profile(name='View Blog Post')
def post(request, post_id):
    p = Post.objects.get(pk=post_id)
    return render_to_response('post.html', {
        'post': p
    })
</code></p>

<p>Whenever a blog post is viewed we get an entry within the Silk UI:</p>

<p><img src="https://raw.githubusercontent.com/mtford90/silk/master/screenshots/7.png" width="720px" /></p>

<p>Silk profiling not only provides execution time, but also collects SQL queries executed within the block in the same fashion as with requests:</p>

<p><img src="https://raw.githubusercontent.com/mtford90/silk/master/screenshots/8.png" width="720px" /></p>

<p>Note that currently profiling does not occur outside of the request/response cycle.</p>

<h2 id="experimental-features">Experimental Features</h2>

<p>The below features are still in need of thorough testing and should be considered experimental.</p>

<h3 id="dynamic-profiling">Dynamic Profiling</h3>

<p>One of Silk’s more interesting features is dynamic profiling. If for example we wanted to profile a function in a dependency to which we only have read-only access (e.g. system python libraries owned by root) we can add the following to <code>settings.py</code> to apply a decorator at runtime:</p>

<p><code>
SILKY_DYNAMIC_PROFILING = [{
    'module': 'path.to.module',
    'function': 'MyClass.bar'
}]
</code></p>

<p>which is roughly equivalent to:</p>

<p><code>
class MyClass(object):
    @silk_profile()
    def bar(self):
        pass
</code></p>

<h3 id="code-generation">Code Generation</h3>

<p>Silk currently generates two bits of code per request:</p>

<p><img src="https://raw.githubusercontent.com/mtford90/silk/master/screenshots/9.png" width="720px" /></p>

<p>Both are intended for use in replaying the request. The curl command can be used to replay via command-line and the python code can be used within a Django unit test or simply as a standalone script.</p>

        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <div id="share">
                <a href="https://twitter.com/share" class="twitter-share-button" data-via="mtford90">Tweet</a>
            </div>
            <div id="disqus_thread"></div>
        </div>
    </div>
</div>

<!-- Twitter -->
<script>
    !function (d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0], p = /^http:/.test(d.location) ? 'http' : 'https';
        if (!d.getElementById(id)) {
            js = d.createElement(s);
            js.id = id;
            js.src = p + '://platform.twitter.com/widgets.js';
            fjs.parentNode.insertBefore(js, fjs);
        }
    }(document, 'script', 'twitter-wjs');
</script>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'mtford-blog'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>

    </div>
</body>
</html>